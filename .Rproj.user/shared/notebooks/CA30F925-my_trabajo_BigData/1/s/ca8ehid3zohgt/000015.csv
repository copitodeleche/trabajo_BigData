"0","#| code-fold: true"
"0","#| warning: false"
"0","library(tidyverse)"
"0","library(rio)"
"0","library(httr)"
"0","library(readxl)"
"0","library(eurostat) "
"0","library(DT)"
"0","library(fs)"
"0",""
"0","fs::dir_create(""datos"")"
"0","# Definir la URL y el destino"
"0","url <- ""https://github.com/copitodeleche/Datos_trabajos/blob/21f73dead967ad21704bead1f332531ffc1b9a04/SAS-BP-Civilian-held-firearms-annexe.xlsx?raw=true"""
"0","destino <- ""./datos/SAS-BP-Civilian-held-firearms-annexe.xlsx"""
"0","aa <- import(url)"
"2","New names:"
"0","write.csv(aa, destino)"
"0",""
"0","aa <- unite(aa, ""Region"", c(""Region"", ""...4""), sep = "" "", remove = TRUE, na.rm = TRUE)"
"0",""
"0","bb <- aa %>%"
"0","  arrange(desc(`Estimate civilian firearms/100 persons`)) %>%"
"0","  filter(Region %in% ""Europe"")"
"0",""
"0",""
"0","url <- ""https://github.com/copitodeleche/Datos_trabajos/blob/c82aa58dbae4f2ad56958a7a4b87f9d20a607d1e/crim_off_cat__custom_9536053_spreadsheet%20(2).xlsx?raw=true"""
"0","eu2 <- import(url)"
"2","New names:"
"0","destino <- ""./datos/crim_off_cat__custom_9536053_spreadsheet%20(2).xlsx"""
"0","write.csv(eu2, destino)"
"0",""
"0","eu <- eu2 %>%"
"0","  select(-where(~all(is.na(.)))) %>%"
"0","  pivot_longer(cols = starts_with(""2""), "
"0","               names_to = ""year"", "
"0","               values_to = ""robos/100k_habitantes"", "
"0","               names_prefix = ""X"") %>%"
"0","  filter(year %in% ""2017"") %>%"
"0","  rename(""Country"" = `GEO (Labels)`) %>%"
"0","  select(""robos/100k_habitantes"" , ""Country"")"
"0",""
"0",""
"0","bb <- bb %>%"
"0","   select(""Population 2017"", ""Estimate of firearms in civilian possession"", ""Country"") %>%"
"0","  mutate(Estimate_of_firearms_per_100k = as.numeric(`Estimate of firearms in civilian possession`) / `Population 2017` * 100000)"
"0",""
"0","result_df <- left_join(bb, eu, by = ""Country"")"
"0","result_df <- result_df %>%"
"0","  mutate_all(~ifelse(. == "":"", NA, .)) %>%"
"0","  drop_na()"
"0",""
